
/* CogJS - v1.0.0 */
var Cog=function(e,t){"use strict";var n={};n.component={};var i={noOperation:t.noop,emptyArray:[],initializedClass:"initialized",initializedSelector:".initialized",globalScopeSelector:"body",modulesGroupSize:50},s=function(){function e(e,n){var i=n||{};e=e||Object;var r=i.constructor!=s?i.constructor:function(){e.apply(this,arguments)},o=e.prototype,u=function(){};u.prototype=o;var l=t.extend(new u,i);return l.constructor=r,r.prototype=l,r.superclass=o,r}function n(e,t){var n={};return n.instance=function(){return t},n.superclass=e.superclass,n}function i(t){var n=e(t,{constructor:function(e){n.superclass.constructor.apply(this,e)}});return n}var s=Object.prototype.constructor;return{define:function(t){return e(null,t)},extend:e,asSingleton:function(e){var t={};return t.create=function(){var t=i(e);return n(e,new t(arguments))},t}}}(),r=s.define({eventManager:null,addModule:function(e){},queueInitTask:function(e,t){},queueFinalizeTask:function(e){},isValidModuleConfig:function(e){},isReady:function(){},whenReady:function(e){}}),o=s.define({dispatcherFor:function(e,t){}}),u=s.define({dependencyGraph:null,modules:null,staticModuleRegistry:null,dynamicModuleRegistry:null,add:function(e){}}),l=s.define({initStaticModule:null,initDynamicModules:null,finalizeDynamicModules:null}),a={off:1,error:2,info:3,debug:4,trace:5},c=s.define({level:a.off,source:null,constructor:function(e,t){this.source=e,this.level=t||a.off},error:function(e){console.error(arguments[1])},info:function(e){},debug:function(e){},trace:function(e){},isEnabled:function(e){return e<=this.level}}),d=s.define({constructor:function(e){},create:function(e,t){}}),h=s.asSingleton(s.extend(d,{logger:new c,create:function(e,t){return this.logger}})).create().instance(),f=s.define({items:null,ids:null,map:null,constructor:function(){this.items=[],this.ids=[],this.map={}},add:function(e,t){this.map[e]||(this.map[e]=t,this.ids.push(e),this.items.push(t))},count:function(){return this.items.length},get:function(e){return this.map[e]||null},has:function(e){return this.map.hasOwnProperty(e)},select:function(e){var t,n,i=new f,s=this.map,r=this.filterIds(e);for(n=0;n<r.length;n++)t=r[n],i.add(t,s[t]);return i},selectValues:function(e){var t,n,i={},s=this.map,r=this.filterIds(e);for(n=0;n<r.length;n++)i[t=r[n]]=s[t];return i},filterIds:function(e){var t,n=[],i=this.uniqueIds(e),s=this.map;for(t=0;t<i.length;t++)s.hasOwnProperty(i[t])&&n.push(i[t]);return n},uniqueIds:function(e){var t,n,i=[],s={};for(n=0;n<e.length;n++)s[t=e[n]]||(s[t]=!0,i.push(t));return this.sortedIds(i)},sortedIds:function(e){var n=t.proxy(this.uniqueIdsSorter,this,this.ids);return e.sort(n),e},uniqueIdsSorter:function(e,n,i){return t.inArray(n,e)-t.inArray(i,e)}}),p=s.define({current:0,next:function(e,t){return this.current++,this.current}}),g=s.asSingleton(s.define({indexOfElement:function(e,t){var n,i=-1;for(n=0;i<0&&n<e.length;n++)t.is(e[n])&&(i=n);return i},find:function(e,t){var n=e.find(t),i=e.filter(t);return i.length>0?n.add(i):n},isInScope:function(e,t){return null!=e&&null!=t&&t.parents().is(e)}})).create().instance(),m=s.asSingleton(s.define({defaults:{itemsPerGroup:1},initializeGroupSize:function(e){return e>0?e:this.defaults.itemsPerGroup},groupItems:function(e,t){var n,i=this.initializeGroupSize(t),s=this.createContext(i),r=s.group;for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n],r=this.update(s));return this.flush(s),s.groups},createContext:function(e){return{group:{},groups:[],counter:e,groupSize:e}},update:function(e){return e.counter--,e.counter<1&&(e.counter=e.groupSize,e.groups.push(e.group),e.group={}),e.group},flush:function(e){e.counter!==e.groupSize&&e.groups.push(e.group)}})).create().instance(),v=s.asSingleton(s.define({create:function(e,n){var i,s,r={};for(s=0;s<n.length;s++)i=n[s],t.isFunction(e[i])&&(r[i]=t.proxy(e[i],e));return r}})).create().instance(),x=s.define({id:null,isProcessed:!1,resolved:!1,dependencies:null,requiredBy:null,constructor:function(e){this.id=e,this.dependencies=[],this.requiredBy=[]},isResolved:function(){return this.resolved},resolveIfRequired:function(){this.resolved||this.resolve()},resolve:function(){var e,t=this.dependencies,n=!0;for(e=0;n&&e<t.length;e++)n=t[e].resolved;this.resolved=n},resolveAllPredecessors:function(){var e=[],t=this.unresolvedPredecessor();return t.length&&this.resolvePredecessors(t,e),e},unresolvedPredecessor:function(){var e,t,n=[],i=this.requiredBy;for(t=0;t<i.length;t++)(e=i[t]).resolved||n.push(e);return n},resolvePredecessors:function(e,t){for(var n;e.length>0;)(n=e.shift()).resolve(),n.resolved&&(e.push.apply(e,n.unresolvedPredecessor()),t.push(n.id))}}),y=s.define({id:function(e){},dependencies:function(e){},dependencyId:function(e){}}),I=s.define({adapter:null,nodes:null,constructor:function(e){this.adapter=e,this.nodes={}},resolve:function(e){var t=null,n=this.getNode(this.adapter.id(e));return n.isProcessed||this.processDependencies(n,this.adapter.dependencies(e)),n.resolveIfRequired(),n.isResolved()&&(t=n.resolveAllPredecessors()).unshift(n.id),t},hasNode:function(e){var t=this.nodes[this.adapter.id(e)];return t&&t.isProcessed},getNode:function(e){return null==this.nodes[e]&&(this.nodes[e]=new x(e)),this.nodes[e]},processDependencies:function(e,t){var n,i;for(i=0;i<t.length;i++)n=this.getNode(this.adapter.dependencyId(t[i])),e.dependencies.push(n),n.requiredBy.push(e);e.isProcessed=!0}}),M=s.define({id:null,delegate:null,scope:null,params:null,disposable:!1,constructor:function(e,t,n){this.id=e.id,this.delegate=t||i.noOperation,this.params={data:{},eventData:{}},n&&this.processOptions(n)},isDisposable:function(){return this.disposable},processOptions:function(e){e.scope&&(this.scope=e.scope),e.data&&(this.params.data=e.data),this.disposable=!0===e.disposable}}),S=s.asSingleton(s.define({create:function(e,t,n){return{module:e,event:t,id:n}}})).create(),z=s.define({asyncDelegatesCount:i.modulesGroupSize,moduleName:null,eventName:null,handlers:null,ids:null,metadataFactory:null,constructor:function(e,t){this.moduleName=e,this.eventName=t,this.metadataFactory=S.instance(),this.handlers=[],this.ids={}},addHandler:function(e,n){var i,s,r=null;return t.isFunction(e)&&(s=this.generateUniqueId(),this.ids[s]=!0,r=this.metadataFactory.create(this.moduleName,this.eventName,s),(i=new M(r,e,n)).isDisposable()&&(i.delegate=this.disposableHandler(i)),this.handlers.push(i)),r},removeHandler:function(e){var t=this.indexOfHandler(e),n=t>-1;return t>-1&&(delete this.ids[e],this.handlers.splice(t,1)),n},dispatch:function(e){var n,i,s,r=this.handlers.slice(0);for(s=0;s<r.length;s++)n=r[s],i=t.extend({},n.params),e&&(i.eventData=e),n.delegate.call(n.scope,i)},dispatchAsync:function(e){var n,i=this.createDelegates(e),s=Math.ceil(i.length/this.asyncDelegatesCount);for(n=0;n<s;n++)setTimeout(t.proxy(this.executeAsync,this,i,n))},createDelegates:function(e){var n,i,s,r=this.handlers.slice(0),o=[];for(s=0;s<r.length;s++)n=r[s],i=t.extend({},n.params),e&&(i.eventData=e),o.push({handler:n,params:i});return o},executeAsync:function(e,t){var n,i,s,r=t*this.asyncDelegatesCount,o=Math.min(r+this.asyncDelegatesCount,e.length);for(s=r;s<o;s++)(n=(i=e[s]).handler).delegate.call(n.scope,i.params)},disposableHandler:function(e){var t=e.delegate,n=this;return function(i){t.call(e.scope,i),n.removeHandler(e.id)}},indexOfHandler:function(e){var t,n=this.handlers,i=-1;for(t=0;i<0&&t<n.length;t++)n[t].id===e&&(i=t);return i},generateUniqueId:function(){var e,t=this.ids;do{e=Math.round((new Date).getTime()*Math.random())}while(null!=t[e]);return e}}),k=s.define({hasNext:function(){},next:function(){},nextId:function(){},last:function(){},lastId:function(){},add:function(e){}}),b=s.extend(k,{queues:null,constructor:function(){this.queues=[]},hasNext:function(){var e,t=this.queues,n=!1;for(e=0;!n&&e<t.length;e++)n=t[e].hasNext();return n},next:function(){var e=this.nextQueue();return null!=e?e.next():null},nextId:function(){var e=this.nextQueue();return null!=e?e.nextId():null},last:function(){var e=this.lastQueue();return null!=e?e.last():null},lastId:function(){var e=this.lastQueue();return null!=e?e.lastId():null},addQueue:function(e){this.queues.push(e)},nextQueue:function(){var e,t,n=this.queues,i=null,s=Number.MAX_VALUE;for(t=0;t<n.length;t++)null!==(e=n[t].nextId())&&e<s&&(s=e,i=n[t]);return i},lastQueue:function(){var e,t,n=this.queues,i=null,s=Number.MIN_VALUE;for(t=0;t<n.length;t++)null!==(e=n[t].nextId())&&e>s&&(s=e,i=n[t]);return i}}),w=s.define({logger:h.create("Task"),counter:new p,id:null,deferred:null,promise:null,constructor:function(){this.id=this.counter.next(),this.deferred=t.Deferred(),this.promise=this.deferred.promise(),this.logger.isEnabled(a.info)&&(this.promise.done(t.proxy(this.onExecuted,this)).fail(t.proxy(this.onAborted,this)),this.logger.debug("created",this.id))},execute:function(){},onExecuted:function(){this.logger.debug("executed",this.id)},onAborted:function(){this.logger.debug("aborted",this.id)}}),R=s.extend(k,{logger:h.create("TaskQueue"),tasks:null,constructor:function(){this.tasks=[]},hasNext:function(){return this.tasks.length>0},next:function(){return this.hasNext()?this.tasks.shift():null},nextId:function(){return this.hasNext()?this.tasks[0].id:null},last:function(){return this.hasNext()?this.tasks.pop():null},lastId:function(){var e=null;if(this.hasNext()){var t=this.tasks;e=t[t.length-1]}return e},add:function(e){var t=this.logger;t.debug("adding task",e.id),this.accepts(e)?(t.debug("task accepted",e.id),this.process(e)):(t.debug("task rejected",e.id),e.deferred.reject())},accepts:function(e){return!0},process:function(e){this.tasks.push(e)}}),A=s.define({logger:h.create("TaskRunner"),delay:0,queues:null,locked:!1,constructor:function(e){this.queues=[],e>0&&(this.delay=e)},executeNext:function(){var e=this.logger,n=this.locked?null:this.findNext();null!=n&&(this.locked=!0,e.trace("locked"),n.promise.always(t.proxy(this.unlock,this)),e.debug("execute",n.id),this.executeAsync(n))},findNext:function(){var e,t=this.queues,n=null;for(e=0;null==n&&e<t.length;e++)n=t[e].next();return n},addQueue:function(e){this.queues.push(e)},unlock:function(){this.locked=!1,this.logger.trace("unlocked"),this.executeNext()},executeAsync:function(e){setTimeout(t.proxy(e.execute,e),this.delay)}}),P=s.define({logger:h.create("ObjectIterator"),items:null,constructor:function(e){this.items=e||{}},eachItem:function(e,n){var i=t.Deferred();try{this.executeOnEach(e,n)}catch(e){this.logger.error("error has occured",e),i.rejectWith(n,[e])}finally{this.logger.trace("processing finished"),i.resolveWith(n)}return i.promise()},executeOnEach:function(e,t){var n,i=this.logger,s=this.items;for(n in s)if(s.hasOwnProperty(n)&&(i.trace("processing",n),!1===e.call(t,s[n]))){i.trace("processing aborted by itemProcessor");break}}}),$=s.define({itemProcessor:null,scope:null,aborted:!1,deferred:null,constructor:function(e,n){this.itemProcessor=e,this.scope=n,this.aborted=!1,this.deferred=t.Deferred(),t.isFunction(e)||this.abort()},isAborted:function(){return this.aborted},abort:function(){this.aborted=!0},resolve:function(){return this.deferred.resolveWith(this.scope)},reject:function(e){return this.abort(),this.deferred.rejectWith(this.scope,[e])},promise:function(){return this.deferred.promise()},processItem:function(e){var t=this.itemProcessor.call(this.scope,e);return!1===t&&this.abort(),t}}),q=s.extend(P,{logger:h.create("AsyncObjectIterator"),defaults:{timeout:0,itemsPerExecution:1},itemsPerExecution:null,timeout:null,allItems:null,constructor:function(e,t,n){q.superclass.constructor.call(this,null);var i=this.defaults;this.allItems=e,this.itemsPerExecution=this.isNonNegative(t)?t:i.itemsPerExecution,this.timeout=this.isNonNegative(n)?n:i.timeout},eachItem:function(e,t){var n=new $(e,t),i=m.groupItems(this.allItems,this.itemsPerExecution);return this.logger.isEnabled(a.trace)&&this.logger.trace("iterating",{groupsCount:i.length,maxGroupSize:this.itemsPerExecution,timeout:this.timeout}),this.eachItemsGroup(n,i),n.promise()},isNonNegative:function(e){return isFinite(e)&&e>=0},eachItemsGroup:function(e,n){if(!e.isAborted()&&n.length>0){this.logger.trace("iterating over group");var i=n.shift(),s=this;setTimeout(function(){s.items=i,q.superclass.eachItem.call(s,e.processItem,e).fail(t.proxy(e.reject,e)),s.eachItemsGroup(e,n)},this.timeout)}else e.resolve()}}),D=s.define({initializedSelector:i.initializedSelector,notInitializedSelector:":not("+i.initializedSelector+")",execute:function(e,t){return null}}),j=s.extend(D,{logger:h.create("SelectElementsDefaultStrategy"),execute:function(e,t){this.logger.trace("executing");var n=this.createSelector(t),i=n?g.find(e,n):null;return this.logger.trace("executed"),i&&i.length>0?i:null},createSelector:function(e){var t,n,i=[],s=e.items;for(n=0;n<s.length;n++)(t=s[n]).selector&&this.processSelector(t.selector,i);return i.join(",")},processSelector:function(e,t){var n,i=this.notInitializedSelector,s=e.split(",");for(n=0;n<s.length;n++)t.push(s[n]+i)}}),N=s.extend(D,{logger:h.create("SelectElementsPrefetchStrategy"),tagNamePattern:/^\w+/i,execute:function(e,t){this.logger.trace("executing");var n=this.createSelectors(t),i=null;return n.prefetch&&(i=g.find(e,n.prefetch).not(this.initializedSelector)),this.logger.trace("executed"),i&&i.length>0?i:null},createSelectors:function(e){var t,n,i=this.initializeSelectors(),s=e.items;for(n=0;n<s.length;n++)(t=s[n]).selector&&this.processSelector(t.selector,i);return i.all=i.all.join(","),i.prefetch=i.prefetch.join(","),i},initializeSelectors:function(){return{all:[],prefetch:[],prefetchMap:{}}},processSelector:function(e,n){var i,s,r,o=this.tagNamePattern,u=e.split(",");for(n.all.push(e),r=0;r<u.length;r++)i=t.trim(u[r]),null!=(s=(s=o.exec(i))&&s.length?s[0]:null)&&(i=s),this.addToPrefetched(n,i)},addToPrefetched:function(e,t){e.prefetchMap[t]||(e.prefetch.push(t),e.prefetchMap[t]=!0)}}),Q=s.extend(R,{relatedQueue:null,constructor:function(e){Q.superclass.constructor.call(this),this.relatedQueue=e||new R},process:function(e){var t=this.joinIndex(e);null!==t?this.join(e,t):Q.superclass.process.call(this,e)},join:function(e,t){},joinIndex:function(e){var t=null;if(this.tasks.length>0){var n=this.relatedQueue.lastId();t=null!==n?this.nextJoinIndex(n):0}return t},nextJoinIndex:function(e){var t,n=null,i=this.tasks;for(t=0;null!==n&&t<i.length;t++)i[t].id>e&&(n=t);return n}}),F=s.extend(w,{logger:h.create("FinalizeModulesTask"),maxGroupSize:i.modulesGroupSize,$scope:null,$elements:null,modules:null,constructor:function(e,t){F.superclass.constructor.call(this),this.modules=t,this.$scope=e},execute:function(){var e=this.logger,n=g.find(this.$scope,i.initializedSelector),s=this.deferred;n.length>0?(e.info("executing",this.id),this.$elements=n,new q(this.modules.map,this.maxGroupSize).eachItem(this.itemProcessor,this).always(t.proxy(s.resolve,s))):(e.info("nothing to do",this.id),s.resolve())},itemProcessor:function(e){var t=this.$elements.filter(e.$elements);return t.length>0&&(this.logger.trace("elements found",e.name,t.length),this.$elements=this.$elements.not(t),e.$elements=e.$elements.not(t),this.finalizeElements(e,t)),this.$elements.length>0},finalizeElements:function(e,t){var n;for(n=0;n<t.length;n++)e.finalize(t.eq(n))}}),T=s.extend(Q,{logger:h.create("FinalizeModulesTaskQueue"),accepts:function(e){return e.$scope&&e.$scope.length},join:function(e,n){var i=this.tasks[n];i.$scope=i.$scope.add(e.$scope),this.logger.trace("join task",{source:e.id,target:i.id,targetIndex:n});var s=e.deferred;i.promise.always(t.proxy(s.resolve,s))}}),E=s.extend(w,{notInitializedSelector:":not("+i.initializedSelector+")",logger:h.create("InitModulesTask"),maxGroupSize:i.modulesGroupSize,elementsStrategy:null,modules:null,moduleIds:null,targetModules:null,$scope:null,$elements:null,rejectDelegate:null,isPrefetchRequired:!1,constructor:function(n,i,s){E.superclass.constructor.call(this),this.isPrefetchRequired=!t.isFunction(e.getElementsByClassName),this.isPrefetchRequired&&(this.maxGroupSize=1),this.elementsStrategy=this.selectElementsStrategy(),this.$scope=n,this.moduleIds=i?s.filterIds(i):null,this.modules=s},selectElementsStrategy:function(){return this.isPrefetchRequired?new N:new j},processAllModules:function(){return null==this.moduleIds},execute:function(){var e=this.logger;this.targetModules=this.processAllModules()?this.modules:this.modules.select(this.moduleIds),this.targetModules.count()>0?(e.info("executing",this.id,{modulesCount:this.targetModules.count()}),this.$elements=this.elementsStrategy.execute(this.$scope,this.targetModules),this.rejectDelegate=t.proxy(this.deferred.reject,this.deferred),this.executeBeforeInit()):(e.info("nothing to do",this.id),this.deferred.resolve())},executeBeforeInit:function(){this.logger.trace("executing beforeInit()",this.id),new q(this.targetModules.map,this.maxGroupSize).eachItem(this.beforeInitProcessor,this).done(t.proxy(this.executeInit,this)).fail(this.rejectDelegate)},executeInit:function(){this.logger.trace("executing init()",this.id);var e=this.deferred;new q(this.targetModules.map,this.maxGroupSize).eachItem(this.initProcessor,this).done(t.proxy(e.resolve,e)).fail(this.rejectDelegate)},beforeInitProcessor:function(e){e.beforeInit()},initProcessor:function(e){var n=null;this.$elements&&e.selector&&(n=this.$elements.filter(e.selector).addClass(i.initializedClass)),e.init(n||t())}}),G=s.extend(Q,{logger:h.create("InitModulesTaskQueue"),accepts:function(e){return e.$scope&&e.$scope.length&&(!e.moduleIds||e.moduleIds.length>0)},join:function(e,t){var n=this.tasks[t];this.logger.trace("join task",{source:e.id,target:n.id,targetIndex:t}),this.joinTasks(n,e)},joinTasks:function(e,n){this.joinScopes(e,n),this.joinModules(e,n);var i=n.deferred;e.promise.always(t.proxy(i.resolve,i))},joinScopes:function(e,t){g.isInScope(t.$scope,e.$scope)?e.$scope=t.$scope:e.$scope.is(t.$scope)||g.isInScope(e.$scope,t.$scope)||(e.$scope=e.$scope.add(t.$scope))},joinModules:function(e,t){!e.processAllModules()&&t.processAllModules()?e.moduleIds=null:e.processAllModules()||t.processAllModules()||(e.moduleIds=this.joinModuleIds(e.moduleIds,t.moduleIds))},joinModuleIds:function(e,t){var n=e.length-t.length,i=n>=0?e:t,s=n<=0?t:e;return this.addModuleIds(s,i),i},addModuleIds:function(e,n){var i;for(i=0;i<e.length;i++)t.inArray(e[i],n)<0&&n.push(e[i])},joinIndex:function(e){var t=G.superclass.joinIndex.call(this,e);return null!==t?this.findJoinIndex(e,t):null},findJoinIndex:function(e,t){var n,i=null,s=this.tasks;for(n=t;null===i&&n<s.length;n++)this.isTaskJoinable(s[n],e)&&(i=n);return i},anyProcessesAllModules:function(e,t){return t.processAllModules()||e.processAllModules()},isTaskJoinable:function(e,t){var n=t.$scope.is(e.$scope);return n||(n=t.processAllModules()&&e.processAllModules()),n||this.anyProcessesAllModules(e,t)||(n=this.equalModuleIds(t.moduleIds,e.moduleIds)),n},equalModuleIds:function(e,n){var i,s=e.length==n.length;for(i=0;s&&i<e.length;i++)s=t.inArray(e[i],n)>=0;return s}}),C=s.define({defaults:{propertyName:"$scope",onUnregister:i.noOperation,onRegister:function(e){return{$scope:e}},scope:null},components:null,config:null,constructor:function(e){e=e||{},this.components=[],this.config=t.extend(!0,{},this.defaults,e),t.isFunction(this.config.onRegister)||(this.config.onRegister=this.defaults.onRegister)},register:function(e){var t,n,i=this.config.onRegister,s=this.config.scope;for(n=0;n<e.length;n++)t=i.call(s,e.eq(n)),this.components.push(t)},unregister:function(e){var t,n=this.indexOfComponent(e);n>=0&&(t=this.components[n],this.components.splice(n,1),this.config.onUnregister.call(this.config.scope,t))},indexOfComponent:function(e){var t=this.components,n=this.config.propertyName;return null!=t&&null!=n&&(t=this.selectProperty(n)),g.indexOfElement(t,e)},selectProperty:function(e){var t,n,i=this.components,s=[],r={};for(n=0;n<i.length;n++)(t=(t=i[n]||r)[e])&&s.push(t);return s}}),O=s.define({name:null,api:null,sharedApi:null,externalApi:null,requires:null,constructor:function(e){this.name=e.name,this.api=e.api,this.sharedApi=e.sharedApi||null,this.externalApi=e.externalApi||{},this.requires=e.requires||i.emptyArray,this.processApi(),this.updateRequiredModules()},init:function(){this.api.init()},updateRequiredModules:function(){var e,n,i=this.requires;for(n=0;n<i.length;n++)e=i[n],"string"===t.type(e)&&(i[n]={name:e})},processApi:function(){this.api.init=this.processDelegate(this.api.init),this.api.external=this.externalApi},processDelegate:function(e){return this.isValidDelegate(e)?e:i.noOperation},isValidDelegate:function(e){return t.isFunction(e)}}),V=s.extend(O,{$elements:null,selector:null,hasFinalize:!1,constructor:function(e){V.superclass.constructor.call(this,e),this.beforeInit=e.api.beforeInit||i.noOperation,this.selector=e.selector||null,this.isFinalizable()&&(this.$elements=t())},init:function(e){this.isFinalizable()&&(this.$elements=this.$elements.add(e)),this.api.init(e)},beforeInit:function(){this.api.beforeInit()},finalize:function(e){this.hasFinalize&&this.api.finalize(e)},isFinalizable:function(){return this.hasFinalize},processApi:function(){V.superclass.processApi.call(this);var e=this.api;e.beforeInit=this.processDelegate(e.beforeInit),this.hasFinalize=this.isValidDelegate(e.finalize)}}),H=s.extend(V,{componentManager:null,constructor:function(e){H.superclass.constructor.call(this,e),this.componentManager=new C({onRegister:this.onRegister,onUnregister:this.api.onUnregister,scope:this})},init:function(e){e.length>0&&this.componentManager.register(e),H.superclass.init.call(this,e)},onRegister:function(e){var t={$scope:e};return this.api.onRegister(t),t},finalize:function(e){H.superclass.finalize.call(this,e),this.componentManager.unregister(e)},isFinalizable:function(){return!0},processApi:function(){H.superclass.processApi.call(this),this.api.onRegister=this.processDelegate(this.api.onRegister),this.api.onUnregister=this.processDelegate(this.api.onUnregister)}}),U=s.extend(y,{id:function(e){return e.name},dependencies:function(e){return e.requires},dependencyId:function(e){return e.name}}),B=s.extend(w,{logger:h.create("InitStaticModuleTask"),maxGroupSize:i.modulesGroupSize,moduleIds:null,modules:null,constructor:function(e,t){B.superclass.constructor.call(this),this.modules=t,this.moduleIds=[],e&&this.moduleIds.push(e)},execute:function(){var e=this.modules.selectValues(this.moduleIds),n=new q(e,this.maxGroupSize);this.logger.trace("executing",this.id,this.moduleIds);var i=this.deferred;n.eachItem(this.itemProcessor,this).always(t.proxy(i.resolve,i))},itemProcessor:function(e){e.init()}}),J=s.extend(R,{logger:h.create("InitStaticModuleTaskQueue"),accepts:function(e){return e.moduleIds.length},process:function(e){this.tasks.length>0?this.join(e):J.superclass.process.call(this,e)},join:function(e){var n=this.tasks[0];this.logger.trace("join task",{source:e.id,target:n.id});var i=n.moduleIds;i.push.apply(i,e.moduleIds);var s=e.deferred;n.promise.always(t.proxy(s.resolve,s))}}),L=s.define({modules:null,constructor:function(){this.modules=new f},add:function(e){this.modules.add(e.name,e)}}),W=s.extend(L,{taskRunner:null,taskQueue:null,constructor:function(e,t){W.superclass.constructor.call(this),this.taskRunner=e,this.taskQueue=t},add:function(e){W.superclass.add.call(this,e),this.taskQueue.add(new B(e.name,this.modules)),this.taskRunner.executeNext()}}),_=s.extend(L,{finalizableModules:null,constructor:function(){_.superclass.constructor.call(this),this.finalizableModules=new f},add:function(e){_.superclass.add.call(this,e),e.isFinalizable()&&this.finalizableModules.add(e.name,e)}}),X=s.extend(o,{events:null,constructor:function(){this.events={}},dispatcherFor:function(e,t){var n=null,i=this.events;if(e&&t){var s=i[e];s&&s[t]||this.addEvent(e,t),n=i[e][t]}return n},addEvent:function(e,t){var n=this.events;n[e]||(n[e]={});var i=n[e];i[t]||(i[t]=new z(e,t))}}),K=s.extend(u,{logger:h.create("ModuleManager"),dependencyGraph:null,modules:null,staticModuleRegistry:null,dynamicModuleRegistry:null,constructor:function(e,t){this.dependencyGraph=new I(new U),this.staticModuleRegistry=e,this.dynamicModuleRegistry=t,this.modules={}},add:function(e){var t=this.logger;if(t.trace("trying add module",e.name),!this.dependencyGraph.hasNode(e)){this.modules[e.name]=e,t.trace("module added",e.name);var n=this.dependencyGraph.resolve(e);t.debug("resolved module id's",n),null!=n&&this.initializeModules(n)}},initializeModules:function(e){var t,n,i=this.modules;for(n=0;n<e.length;n++)(t=i[e[n]])&&this.initializeModule(t)},initializeModule:function(e){this.injectApi(e),(e instanceof V?this.dynamicModuleRegistry:this.staticModuleRegistry).add(e)},injectApi:function(e){var t,n,i,s=this.modules,r=e.requires;for(i=0;i<r.length;i++)t=s[(n=r[i]).name],n.apiId&&(e.externalApi[n.apiId]=t.sharedApi||null)}}),Y=s.extend(l,{constructor:function(){this.initStaticModule=new J,this.initializeDynamicModuleQueues()},initializeDynamicModuleQueues:function(){var e=new b;this.initDynamicModules=new G(e);var t=new b;this.finalizeDynamicModules=new T(t),e.addQueue(this.finalizeDynamicModules),t.addQueue(this.initDynamicModules)}}),Z=s.asSingleton(s.extend(r,{eventManager:null,taskQueues:null,taskRunner:null,moduleManager:null,dynamicModuleRegistry:null,ready:!1,constructor:function(){this.eventManager=new X,this.taskQueues=new Y,this.taskRunner=this.initializeTaskRunner(),this.moduleManager=this.initializeModuleManager(),this.dynamicModuleRegistry=this.moduleManager.dynamicModuleRegistry,this.whenReady(t.proxy(this.onReady,this))},isValidModuleConfig:function(e){return e&&e.name&&e.api},addModule:function(e){this.moduleManager.add(e)},queueInitTask:function(e,t){var n=new E(e,t,this.dynamicModuleRegistry.modules);return this.taskQueues.initDynamicModules.add(n),this.taskRunner.executeNext(),n.promise},queueFinalizeTask:function(e){var t=new F(e,this.dynamicModuleRegistry.finalizableModules);return this.taskQueues.finalizeDynamicModules.add(t),this.taskRunner.executeNext(),t.promise},whenReady:function(n){t(e).ready(n)},isReady:function(){return this.ready},onReady:function(){this.ready=!0},initializeTaskRunner:function(){var e=new A,t=this.taskQueues;e.addQueue(t.initStaticModule);var n=new b;return n.addQueue(t.initDynamicModules),n.addQueue(t.finalizeDynamicModules),e.addQueue(n),e},initializeModuleManager:function(){var e=new W(this.taskRunner,this.taskQueues.initStaticModule),t=new _;return new K(e,t)}})).create().instance(),ee=h.create("CogJS",3);return n.Type={define:s.define,extend:s.extend,asSingleton:s.asSingleton},n.registerStatic=function(e){Z.isValidModuleConfig(e)?Z.addModule(new O(e)):ee.error("Invalid StaticModule config",e)},n.register=function(e){Z.isValidModuleConfig(e)?Z.addModule(new V(e)):ee.error("Invalid DynamicModule config",e)},n.registerComponent=function(e){Z.isValidModuleConfig(e)&&t.isFunction(e.api.onRegister)?Z.addModule(new H(e)):ee.error("Invalid ComponentModule config",e)},n.finalize=function(e){return Z.isReady()?Z.queueFinalizeTask(e||t(i.globalScopeSelector)):null},n.init=function(e){function n(e){return e.$element||t(i.globalScopeSelector)}function s(e){return t.isArray(e.modules)?e.modules:null}return function(){var t=null;return Z.isReady()&&(e=e||{},t=Z.queueInitTask(n(e),s(e))),t}}(),n.addListener=function(e,n,i,s){var r=t.isFunction(i)?Z.eventManager.dispatcherFor(e,n):null,o=null;return null!=r?o=r.addHandler(i,s):ee.error("Invalid EventHandler config",arguments),o},n.removeListener=function(e){var t=!1;return e&&(t=Z.eventManager.dispatcherFor(e.module,e.event).removeHandler(e.id)),t},n.fireEvent=function(e,t,n){var i=Z.eventManager.dispatcherFor(e,t);null!=i&&i.dispatch(n)},n.fireEventAsync=function(e,t,n){var i=Z.eventManager.dispatcherFor(e,t);null!=i&&i.dispatchAsync(n)},n.ready=function(e){Z.whenReady(e)},n.isInScope=function(e,t){return g.isInScope(e,t)},n.find=function(e,t){return g.find(e,t)},n.jQuery=function(){return t},n.logger=function(e,t){var n=null;return e&&(n=v.create(h.create(e,t),["error","debug","info"])),n},n.Cookie={create:function(t,n,i){var s,r="";i&&((s=new Date).setTime(s.getTime()+24*i*60*60*1e3),r="; expires="+s.toGMTString()),e.cookie=t+"="+n+r+"; path=/"},read:function(t){var n,i=t+"=",s=e.cookie.split(";"),r=null;for(n=0;n<s.length;n++){for(r=s[n];" "==r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(i))return r.substring(i.length,r.length)}return null},erase:function(e){n.Cookie.create(e,"",-1)}},Z.whenReady(n.init),window.$=t,n}(document,jQuery.noConflict(!0));
